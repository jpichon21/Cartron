/**
 * La colline
 *
 * Copyright (c) 2012 - Indigen Solutions
 * Authors:
 *   - Jérôme Barbato <jerome@bighub.fr>
 *
 * License: GPL 
 * Version: 1.0 (2013/03/27)
 *
 * Requires:
 *   - jQuery
 *
 **/

/**
 * indigen namespace.
 */
var lacolline = lacolline || {};

/**
 *
 */
lacolline.page = function(config) 
{  

    var that = this;
	
	that.window 	= null;
	that.content 	= null;
	
	that.config = 
	{
		'content'		: 'section.page',	
		'min_height'	: 400,        
    };
	
    /* Public attributes. */


    /* Public methods. */
	
	that.resize = function()
	{
		
		$j(window).resize(function(e) 
		{
        	if( !!that.content && !!that.window)
			{     
				var window_height = that.window.height();
				
				console.log(lacolline.config.header_height);
				console.log(lacolline.menu.nav_height);
				var content_height 	= window_height-lacolline.config.header_height-lacolline.config.footer_height-lacolline.menu.nav_height;
				content_height 		= content_height>that.config.min_height?content_height:that.config.min_height;

				that.content.height( content_height );
			}	
				
        }).resize();
	}
	
	that.enhance_table_description = function()
	{
		that.content.find('.description table tr').each(function(index, element) 
		{
			$j(element).addClass('row_count_'+$j(element).find('td').length ); 
		});
	}
	
	that.gallery = function()
	{
		if( !that.content.hasClass('gallery') ) return;
		
		var $img = that.content.find('.description img');
		var initial_length = $img.length;
		
		
		if( initial_length == 1 ) $img.parent().append($img.clone()).append($img.clone());
		else if( initial_length == 2 ) $img.parent().append($img.clone());
		else if( initial_length == 3 ) $img.parent().append($img.first().clone());

		$img = that.content.find('.description img');
		var $description = that.content.find('.description');
		
		$description.wrapInner('<dic class="scroll"/>')
		$description.find('.scroll').width( $img.length * 990 );
		$description.append('<div class="next"/><div class="prev"/>');
		
		$img.css('opacity', 0.5);
		$img.eq(1).addClass('active').css('opacity', 1);
		$img.eq(0).css('left','-100%');
		$img.eq(2).css('left','100%');
		
		that.content.find('.next, .prev').click(function() 
		{
			var $active = that.content.find('img.active');				
			var $scroll = that.content.find('.scroll');				
			var next = $j(this).hasClass('next');
			
			var $next = next?$active.next():$active.prev();
			
			/*if( next ) $scroll.append($img.first());
			else  $scroll.preppend($img.last());*/
			
			$scroll.animate({'left': (next?'-=':'+=')+'100%'}, 500)

		});

	}
			
    that._init = function(config)
	{ 	
		that.config = $j.extend(that.config, config);

		$j(document).ready(function(e)
		{ 
			that.window 	= $j(window);
			that.content 	= $j(that.config.content);
			
			that.enhance_table_description();
			that.gallery();
			
			that.resize();
		})
	}

    that._init(config);

    return that;
};

